---
title: "GoA_Agg"
author: "Dylan Titmuss"
date: "9/17/2021"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

## Load data
```{r}
aggData <- read.csv("aggData.csv") %>%
  mutate(score = replace(score, score == "X", 8)) %>%
  mutate(score = as.numeric(score))

count(aggData, birdID)

count(aggData, days_pre_hatch)

# Only one datapoint for *UB, 0EE, 1C3, 2EE, 3P2 & 8EX
```

## Visualize aggression over time
```{r}
# Create dataset excluding individuals with only one obs
aggData_filt <- aggData %>%
  mutate(birdID = factor(birdID, levels = c("0EE", "9Z4", "8EX", "4F7", "2EE", "6V4", "0T4", "6HU", "1K9", "9EF", "2E2", "*UB", "0HZ", "2HZ", "1Z5", "5Y3", "0HX", "7JM", "3AP", "9AC", "1HY", "1C3", "7U9", "0AC", "7E6", "3HE", "2M8", "0FU", "3P2", "FED", "1M7", "9JP", "6R3", "4AC"))) %>%
  filter(birdID != "*UB" & birdID != "0EE" & birdID != "1C3" & birdID != "2EE" & birdID != "3P2" & birdID != "8EX")

ggplot(aggData_filt, aes(x = days_pre_hatch, y = score, color = nestID)) +
  geom_point() +
  geom_line() +
  facet_wrap(~ birdID) +
  scale_x_reverse() +
  ylim(1, 8) +
  scale_color_manual(values = pal3) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

# Average scores per incubation day across all individuals

aggData_grp <- aggData %>%
  group_by(days_pre_hatch) %>%
  summarise(score = mean(score))

ggplot(aggData_grp, aes(x = days_pre_hatch, y = score)) +
  geom_point() +
  geom_line() +
  scale_x_reverse() +
  ylim(1, 8) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        axis.line = element_line(colour = "black"))
```

## Analyze data
```{r}
# 1: Does aggression throughout the breeding season vary among individuals?

m2 <- lm(score ~ days_pre_hatch + birdID, data = aggData)
summary(m2) # p-value = 4.138e-12

## Check residuals
par(mfrow = c(2, 2))
plot(m2)
par(mfrow = c(1, 1))

# 2: Does an individual's aggression vary over the course of the breeding season? (i.e. Is each individual gull's aggression affected by incubation timepoint?) #USE FILT DATA


# Test for linear relationship
aggData$daysRank <- rank(aggData$days_pre_hatch)
aggData$scoreRank <- rank(aggData$score)
plot(aggData$daysRank, aggData$scoreRank)

```
