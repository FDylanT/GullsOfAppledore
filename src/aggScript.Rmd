---
title: "GoA_Agg"
author: "Dylan Titmuss"
date: "9/17/2021"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lme4)
library(lmerTest)
```

## Load data
```{r}
setwd("~/Desktop/Repos/GullsOfAppledore")
aggData <- read.csv("./data/aggData.csv") %>%
  mutate(score = replace(score, score == "X", 8)) %>%
  mutate(score = as.numeric(score)) %>%
  mutate(birdID = factor(birdID, levels = c("0EE", "9Z4", "8EX", "4F7", "2EE", "6V4", "0T4", "6HU", "1K9", "9EF", "2E2", "*UB", "0HZ", "2HZ", "1Z5", "5Y3", "0HX", "7JM", "3AP", "9AC", "1HY", "1C3", "7U9", "0AC", "7E6", "3HE", "2M8", "0FU", "3P2", "FED", "1M7", "9JP", "6R3", "4AC")))

# count(aggData, birdID) # only one datapoint for 0EE, 8EX, 2EE, *UB, 1C3 & 3P2

# Create filtered dataset excluding individuals with only one obs
aggData_filt <- aggData %>%
  filter(birdID != "0EE" & birdID != "8EX" & birdID != "2EE" & birdID != "*UB" & birdID != "1C3" & birdID != "3P2")

count(aggData, birdID) # 3+ obs for 4F7, 0T4, 9EF, 2E2, 2HZ, 1Z5, 0HX, 7JM, 3AP, 7U9, 7E6, 3HE, 2M8, 9JP, 4AC

# Create filtered dataset including only individuals with 3+ obs
aggData_3 <- aggData %>%
  filter(birdID == "4F7" | birdID == "0T4" | birdID == "9EF" | birdID == "2E2" | birdID == "2HZ" | birdID == "1Z5" | birdID == "0HX" | birdID == "7JM" | birdID == "3AP" | birdID == "7U9" | birdID == "7E6" | birdID == "3HE" | birdID == "2M8" | birdID == "9JP" | birdID == "4AC")
```

## Visualize aggression over time
```{r}
ggplot(aggData_filt, aes(x = days_pre_hatch, y = score, color = nestID)) +
  geom_point() +
  geom_line() +
  facet_wrap(~ birdID, ncol = 7) +
  scale_x_reverse() +
  ylim(1, 8) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        axis.line = element_line(colour = "black"))

# Average scores per incubation day across all individuals
aggData_grp <- aggData %>%
  group_by(days_pre_hatch) %>%
  summarise(score = mean(score))

ggplot(aggData_grp, aes(x = days_pre_hatch, y = score)) +
  geom_point() +
  geom_line() +
  scale_x_reverse() +
  ylim(1, 8) +
  labs(title = "Aggression Over Time, Averaged Across Individuals") +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        axis.line = element_line(colour = "black"))
```

# Only individuals with 3+ obs
```{r}
### this one ###
ggplot(aggData_3, aes(x = days_pre_hatch, y = score)) +
  geom_point() +
  geom_line() +
  facet_wrap(~ birdID, ncol = 3) +
  scale_x_reverse() +
  ylim(1, 8) +
  labs(x = "Days Before First Hatch", y = "Aggression Score", title = "Individuals' Aggression Over Time", subtitle = "(including gulls with three or more behavioral scores)") +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        axis.line = element_line(colour = "black"),
        plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
        plot.subtitle = element_text(size = 12, face = "italic", hjust = 0.5),
        axis.title = element_text(size = 14, face = "bold"),
        axis.text = element_text(size = 10))

# Average scores per incubation day across individuals with 3+ obs
aggData_3_grp <- aggData_3 %>%
  group_by(days_pre_hatch) %>%
  summarise(score = mean(score))

### this one ###
ggplot(aggData_3_grp, aes(x = days_pre_hatch, y = score)) +
  geom_point() +
  geom_line() +
  scale_x_reverse() +
  ylim(1, 8) +
  labs(x = "Days Before First Hatch", y = "Aggression Score", title = "Aggression Over Time, Averaged Across Individuals") +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        axis.line = element_line(colour = "black"),
        plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
        axis.title = element_text(size = 14, face = "bold"),
        axis.text = element_text(size = 10))
```

## Analyze data (individuals with 3+ obs)

1: Does aggression vary over the course of the breeding season? (i.e. Is aggression affected by incubation timepoint?)

```{r}
m1 <- lmer(score ~ days_pre_hatch + (1|birdID), data = aggData_3)
summary(m1)

par(mfrow = c(2, 2))
plot(m1)
par(mfrow = c(1, 1))
```

_2: Does aggression throughout the breeding season vary among individuals?_

3: How does aggression vary within mated pairs?

# Check for patterns by nest ID
```{r}
# Average scores by individual
aggData_indiv_grp <- aggData %>%
  group_by(birdID, nestID) %>%
  summarise(score = mean(score))

ggplot(aggData_indiv_grp, aes(x = nestID, y = score)) +
  geom_point() +
  ylim(1, 8) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        axis.line = element_line(colour = "black"),
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))

### this one ###
ggplot(aggData, aes(x = days_pre_hatch, y = score)) +
  geom_point() +
  geom_line(aes(lty = birdID)) +
  facet_wrap(~ nestID, ncol = 6) +
  scale_x_reverse() +
  ylim(1, 8) +
  scale_linetype_manual(values = c("solid", "22", "solid", "22", "solid", "22", "22", "solid", "solid", "22", "22", "solid", "solid", "22", "22", "solid", "solid", "22", "solid", "22", "22", "solid", "solid", "22", "solid", "22", "solid", "22", "solid", "22", "solid", "22", "solid", "22")) +
  labs(x = "Days Before First Hatch", y = "Aggression Score", title = "Aggression Over Time Among Mated Pairs") +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        axis.line = element_line(colour = "black"),
        plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
        axis.title = element_text(size = 14, face = "bold"),
        axis.text = element_text(size = 10),
        legend.position = "none")
```

# Analysis
```{r}
## all individuals
n1 <- aov(score ~ nestID, data = aggData)
anova(n1)

n2 <- lm(score ~ nestID, data = aggData)
summary(n2)

# Check for patterns over time by nest ID

## all individuals
n4 <- lm(score ~ days_pre_hatch + nestID, data = aggData)
summary(n4)

n5 <- lm(score ~ days_pre_hatch * nestID, data = aggData)
summary(n5)

## individuals with 2+ obs
n6 <- lm(score ~ days_pre_hatch + nestID, data = aggData_filt)
summary(n6)

n7 <- lm(score ~ days_pre_hatch * nestID, data = aggData_filt)
summary(n7)

## individuals with 3+ obs
n8 <- lm(score ~ days_pre_hatch + nestID, data = aggData_3)
summary(n8)

n9 <- lm(score ~ days_pre_hatch * nestID, data = aggData_3)
summary(n9)

```
